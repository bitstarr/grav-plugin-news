{% spaceless %}

{# GENERIC SETTINGS #}
{% set current_page = uri.param('page')|default(1)|int %}
{% set limit = config.plugins.news.news_per_page|int %}
{% set start = (current_page - 1) * limit %}

{% set search = uri.param('search') %}
{% if search %}
    {% set collection = collection.search(search) %}
{% endif %}

{% set count = collection|length %}
{% set collection_slice = collection.limit(start, limit) %} {# this is your pagination #}

{# {% render collection layout: 'json' with {x: x, y: y, count: count} %} #}
{% endspaceless %}

{% if collection_slice == null -%}
    <p class="notice notice--warning">
        {{ 'PLUGIN_NEWS.NO_ENTRIES'|t }}
    </p>
{% endif -%}

{% for post in collection_slice %}
    {% set url = config.plugins.news.news_page ~ '/' ~ post.slug %}
    <article class="news">
        <header class="news__header">
            <h1 class="news__title">
                <a class="news__titleLink" href="{{ url }}">
                    {{ post.title }}
                </a>
            </h1>
            <p class="news__date">
                <time class="news__datetime dt-published" datetime="{{ post.date|date("c") }}">
                    {{ post.date|localizeddate( 'long', 'none', site.default_lang ) }}
                </time>
            </p>
        </header>

        <div class="news__excerpt textflow">
            {% if post.excerpt %}
                {{ post.excerpt|markdown|raw }}
            {% else %}
                {{ post.content|truncate(400, true)|markdown|striptags('<p><strong><em>')|raw }}
            {% endif %}

            <p>
                <a class="news__action" href="{{ url }}">
                    <span class="hex">
                        {{ svg('action')|raw }}
                    </span>
                    {{ 'PLUGIN_NEWS.CONTINUE_READING'|t }}
                </a>
            </p>
        </div>

        {% if post.hero is defined -%}
            {% set hero_image = post.media[post.hero] -%}
            {% set image = hero_image.cropZoom(250,500).quality(90).url %}
            <img class="news__image"
                src="{{ image }}"
                width="210"
                height="460"
                alt="{{ hero_image.metadata.alt }}"
                loading="lazy"
                >
        {% endif -%}

    </article>
{% endfor %}